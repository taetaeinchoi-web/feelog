<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FEELOG</title>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/static/pretendard.css" />
</head>

<body>

  <a href="calendar.html" class="view-records-btn">기록보기</a>

  <main class="container">
    <header class="header">
      <h1 class="logo">FEELOG</h1>
      <p class="subtitle">오늘 하루의 색을 골라주세요</p>
    </header>

    <div id="color-cluster" class="color-cluster">
      <!-- Colors will be generated by JS -->
    </div>
  </main>

  <script>
    // Emotion Color Data (Merged from emotion.html logic but simplified for index)
    // We need a rich palette of colors. 
    // Based on the image, there are many colors arranged in circles.
    // I will generate a comprehensive list of nice colors.

    const colors = [
      // Reds / Pinks
      "#8B0000", "#B22222", "#FF0000", "#FF4500", "#FF6347", "#FF1493", "#C71585",
      // Oranges / Yellows
      "#FF8C00", "#FFA500", "#FFD700", "#FFFF00", "#F0E68C", "#BDB76B",
      // Greens
      "#556B2F", "#6B8E23", "#008000", "#32CD32", "#90EE90", "	#00FA9A", "#00CCA3",
      // Blues
      "#008080", "#00CED1", "#4682B4", "#1E90FF", "#0000FF", "#00008B", "#191970",
      // Purples / Violets
      "#4B0082", "#800080", "#8A2BE2", "#9370DB", "#BA55D3", "#DDA0DD",
      // Grays / Black / White
      "#000000", "#696969", "#A9A9A9", "#D3D3D3", "#F5F5F5", "#FFFFFF"
    ];

    // Actually, let's try to match the image's vibrant palette better or just use a generated spectrum.
    // The image shows a spiral/concentric layout.
    // Let's generate a list of HSL colors to get a nice rainbow spectrum + shades.

    function generateColors() {
      const cluster = document.getElementById('color-cluster');

      // Goal: Perfect Rectangle      // Group by Hue for Vertical Layout
      // We iterate through baseHues and create a row for each.

      const baseHues = [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330]; // 12 columns

      baseHues.forEach(h => {
        const row = document.createElement('div');
        row.className = 'hue-row';

        // 4 variants per hue: Bright, Pure, Deep, Very Dark
        const variants = [
          `hsl(${h}, 90%, 60%)`, // Bright
          `hsl(${h}, 95%, 50%)`, // Pure
          `hsl(${h}, 90%, 40%)`, // Deep
          `hsl(${h}, 90%, 25%)`  // Very Dark
        ];

        variants.forEach(color => {
          const btn = createColorBtn(color);
          row.appendChild(btn);
        });

        cluster.appendChild(row);
      });

      // Grayscale Row
      const grayRow = document.createElement('div');
      grayRow.className = 'hue-row';
      grayRow.style.flexWrap = 'wrap'; // Allow wrapping if too many
      grayRow.style.maxWidth = '300px'; // Constrain width to force consistent grid if needed, or just let it flow

      const grays = [
        "#ffffff", "#bfbfbf", "#404040", "#000000"
      ];

      grays.forEach(color => {
        const btn = createColorBtn(color);
        grayRow.appendChild(btn);
      });
      cluster.appendChild(grayRow);

      // Animation
      requestAnimationFrame(() => {
        const circles = document.querySelectorAll('.color-circle');
        circles.forEach((circle) => {
          const randomDelay = Math.random() * 0.8;
          circle.style.animationDelay = `${randomDelay}s`;
          circle.classList.add('animate-in');
        });
      });
    }

    function createColorBtn(color) {
      const btn = document.createElement('button');
      btn.className = 'color-circle';
      btn.style.backgroundColor = color;
      btn.dataset.color = colorToHex(color);
      btn.addEventListener('click', (e) => handleColorSelect(e, btn));
      return btn;
    }

    function colorToHex(color) {
      // Handle HSL to Hex conversion
      if (color.startsWith("hsl")) {
        const sep = color.indexOf(",") > -1 ? "," : " ";
        const hsl = color.substr(4).split(")")[0].split(sep);

        let h = parseInt(hsl[0]);
        let s = parseInt(hsl[1].substr(0, hsl[1].length - 1)) / 100;
        let l = parseInt(hsl[2].substr(0, hsl[2].length - 1)) / 100;

        let c = (1 - Math.abs(2 * l - 1)) * s;
        let x = c * (1 - Math.abs((h / 60) % 2 - 1));
        let m = l - c / 2;
        let r = 0, g = 0, b = 0;

        if (0 <= h && h < 60) { r = c; g = x; b = 0; }
        else if (60 <= h && h < 120) { r = x; g = c; b = 0; }
        else if (120 <= h && h < 180) { r = 0; g = c; b = x; }
        else if (180 <= h && h < 240) { r = 0; g = x; b = c; }
        else if (240 <= h && h < 300) { r = x; g = 0; b = c; }
        else if (300 <= h && h < 360) { r = c; g = 0; b = x; }

        r = Math.round((r + m) * 255).toString(16).padStart(2, '0');
        g = Math.round((g + m) * 255).toString(16).padStart(2, '0');
        b = Math.round((b + m) * 255).toString(16).padStart(2, '0');

        return `#${r}${g}${b}`;
      }
      return color; // Assume it's already hex or valid
    }

    function handleColorSelect(e, btn) {
      const color = btn.dataset.color;

      // 1. Storage
      // We store this as a 'session color' or 'theme color'
      // We might also want to save a record if this is "Today's Color".
      // Since user said "Go to result page", let's assume we just setting the theme for now 
      // OR strictly following instructions: "Apply to background/calendar/history".

      localStorage.setItem('feelog_theme_color', color);
      localStorage.setItem('feelog_lastColor', color); // For text.html compatibility

      // 2. Animation
      btn.classList.add('selected');

      // 3. Navigation
      setTimeout(() => {
        // Navigate to text.html for recording
        location.href = `text.html?color=${color.replace('#', '')}`;
      }, 500);
    }

    // Init
    document.addEventListener('DOMContentLoaded', generateColors);

  </script>

</body>

</html>
